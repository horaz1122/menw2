<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>پلانەری ساڵانە</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: #f3f4f6;
        }
        .day-cell {
            min-height: 100px;
            transition: all 0.2s;
        }
        .day-cell:hover {
            background-color: #e5e7eb;
            cursor: pointer;
        }
        .active-day {
            background-color: #dbeafe;
            border: 2px solid #3b82f6;
        }
    </style>
</head>
<body class="p-6">

    <div class="max-w-6xl mx-auto bg-white rounded-lg shadow-xl overflow-hidden">
        
        <div class="bg-indigo-600 p-6 text-white flex justify-between items-center">
            <h1 class="text-3xl font-bold">پلانەری ساڵانە</h1>
            <div class="flex items-center gap-4">
                <button onclick="changeMonth(-1)" class="bg-indigo-500 hover:bg-indigo-700 px-4 py-2 rounded text-lg font-bold">&lt; پێشوو</button>
                <h2 id="currentDateDisplay" class="text-2xl font-semibold w-48 text-center"></h2>
                <button onclick="changeMonth(1)" class="bg-indigo-500 hover:bg-indigo-700 px-4 py-2 rounded text-lg font-bold">داهاتوو &gt;</button>
            </div>
        </div>

        <div class="grid grid-cols-7 bg-gray-100 border-b border-gray-200 text-center py-2 font-bold text-gray-700">
            <div>شەممە</div>
            <div>یەکشەممە</div>
            <div>دووشەممە</div>
            <div>سێشەممە</div>
            <div>چوارشەممە</div>
            <div>پێنجشەممە</div>
            <div>هەینی</div>
        </div>

        <div id="calendarGrid" class="grid grid-cols-7 border-l border-t border-gray-200">
            </div>

    </div>

    <div id="eventModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex justify-center items-center z-50">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-md p-6 mx-4">
            <div class="flex justify-between items-center mb-4 border-b pb-2">
                <h3 class="text-xl font-bold text-indigo-600">پلانی ڕۆژی <span id="modalDateDisplay"></span></h3>
                <button onclick="closeModal()" class="text-gray-500 hover:text-red-500 text-2xl">&times;</button>
            </div>
            
            <div class="mb-4">
                <label class="block text-gray-700 mb-2">تێبینی یان پلانەکەت بنوسە:</label>
                <textarea id="eventText" class="w-full border border-gray-300 rounded p-2 h-32 focus:outline-none focus:border-indigo-500" placeholder="نموونە: کۆبوونەوە لەگەڵ تیم..."></textarea>
            </div>

            <div class="flex justify-end gap-2">
                <button onclick="deleteEvent()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded">سڕینەوە</button>
                <button onclick="saveEvent()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded">پاشەکەوتکردن</button>
            </div>
        </div>
    </div>

    <script>
        let nav = 0;
        let clicked = null;
        let events = localStorage.getItem('events') ? JSON.parse(localStorage.getItem('events')) : [];

        const calendar = document.getElementById('calendarGrid');
        const eventModal = document.getElementById('eventModal');
        const modalDateDisplay = document.getElementById('modalDateDisplay');
        const eventText = document.getElementById('eventText');
        
        // Month names in Kurdish
        const monthNames = [
            "کانوونی دووەم", "شوبات", "ئازار", "نیسان", "ئایار", "حوزەیران",
            "تەمموز", "ئاب", "ئەیلول", "تشرینی یەکەم", "تشرینی دووەم", "کانوونی یەکەم"
        ];

        function load() {
            const dt = new Date();

            if (nav !== 0) {
                dt.setMonth(new Date().getMonth() + nav);
            }

            const day = dt.getDate();
            const month = dt.getMonth();
            const year = dt.getFullYear();

            const firstDayOfMonth = new Date(year, month, 1);
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            const dateString = firstDayOfMonth.toLocaleDateString('en-us', {
                weekday: 'long',
                year: 'numeric',
                month: 'numeric',
                day: 'numeric',
            });
            
            // Calculate padding days (to start from Saturday/Sunday correctly)
            // Adjusting for Saturday start (Saturday = 0 in our logic roughly)
            const paddingDays = (firstDayOfMonth.getDay() + 1) % 7; 

            document.getElementById('currentDateDisplay').innerText = `${monthNames[month]} ${year}`;

            calendar.innerHTML = '';

            for(let i = 1; i <= paddingDays + daysInMonth; i++) {
                const daySquare = document.createElement('div');
                daySquare.classList.add('day-cell', 'border-b', 'border-r', 'border-gray-200', 'p-2', 'flex', 'flex-col', 'justify-between');

                if (i > paddingDays) {
                    const dayNum = i - paddingDays;
                    const dayString = `${year}/${month + 1}/${dayNum}`;
                    
                    // Display Day Number
                    const dayNumberElem = document.createElement('div');
                    dayNumberElem.innerText = dayNum;
                    dayNumberElem.classList.add('font-bold', 'text-gray-700');
                    daySquare.appendChild(dayNumberElem);

                    // Check for Event
                    const eventForDay = events.find(e => e.date === dayString);
                    if (eventForDay) {
                        const eventDiv = document.createElement('div');
                        eventDiv.innerText = eventForDay.title;
                        eventDiv.classList.add('bg-indigo-100', 'text-indigo-800', 'text-sm', 'p-1', 'rounded', 'mt-1', 'truncate');
                        daySquare.appendChild(eventDiv);
                    }

                    // Highlight Current Day
                    if (dayNum === day && nav === 0) {
                        daySquare.classList.add('bg-blue-50');
                        dayNumberElem.classList.add('text-blue-600');
                    }

                    daySquare.addEventListener('click', () => openModal(dayString));
                } else {
                    daySquare.classList.add('bg-gray-50'); // Empty padding days
                }

                calendar.appendChild(daySquare);
            }
        }

        function openModal(date) {
            clicked = date;
            const eventForDay = events.find(e => e.date === clicked);

            modalDateDisplay.innerText = clicked;

            if (eventForDay) {
                eventText.value = eventForDay.title;
            } else {
                eventText.value = '';
            }

            eventModal.classList.remove('hidden');
        }

        function closeModal() {
            eventModal.classList.add('hidden');
            eventText.value = '';
            clicked = null;
            load();
        }

        function saveEvent() {
            if (eventText.value) {
                // Remove existing event if any to overwrite
                events = events.filter(e => e.date !== clicked);
                
                events.push({
                    date: clicked,
                    title: eventText.value,
                });

                localStorage.setItem('events', JSON.stringify(events));
                closeModal();
            }
        }

        function deleteEvent() {
            events = events.filter(e => e.date !== clicked);
            localStorage.setItem('events', JSON.stringify(events));
            closeModal();
        }

        function changeMonth(direction) {
            nav += direction;
            load();
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            if (event.target == eventModal) {
                closeModal();
            }
        }

        // Init
        load();
    </script>
</body>
</html>
