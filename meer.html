import React, { useState, useRef, useEffect } from 'react';
import { Send, Leaf, Sprout, Sun, Droplets, Info, User, Bot, MapPin, Clock, Heart, Sparkles, Phone, AlertTriangle } from 'lucide-react';

// Ù¾ÛŽÚ©Ù‡Ø§ØªÛ•ÛŒ ÙˆÛŽÙ†Û•ÛŒ Ø¨Û†Øª
const BotAvatar = () => {
  const [imgError, setImgError] = useState(false);

  if (imgError) {
    return (
      <div className="w-full h-full bg-gradient-to-br from-emerald-100 to-emerald-200 flex items-center justify-center">
        <Bot size={20} className="text-emerald-700" />
      </div>
    );
  }

  return (
    <img 
      src="mer.jpg" 
      alt="Bot" 
      className="w-full h-full object-cover" 
      onError={() => setImgError(true)} 
    />
  );
};

// Ø¨Ù†Ú©Û•ÛŒ Ø²Ø§Ù†ÛŒØ§Ø±ÛŒ Ú•ÙˆÛ•Ú©Û•Ú©Ø§Ù† Ùˆ Ù†Û•Ø®Û†Ø´ÛŒÛŒÛ•Ú©Ø§Ù†
const knowledgeBase = {
  plants: {
    'Ù…Û•ØªØ§Øª': 'ðŸŒ¿ **Ú•ÙˆÛ•Ú©ÛŒ Ù…Û•ØªØ§Øª (Rubber Plant):**\nâ€¢ **Ú•ÙˆÙˆÙ†Ø§Ú©ÛŒ:** Ø­Û•Ø²ÛŒ Ø¨Û• Ú•ÙˆÙˆÙ†Ø§Ú©ÛŒ Ø²Û†Ø±Û• Ø¨Û•ÚµØ§Ù… Ù†Ø§Ú•Ø§Ø³ØªÛ•ÙˆØ®Û†.\nâ€¢ **Ø¦Ø§Ùˆ:** Ú©Ø§ØªÛŽÚ© Ù¢ Ø³Ù… Ù„Û• Ø®Ø§Ú©Û•Ú©Û•ÛŒ ÙˆØ´Ú© Ø¨ÙˆÙˆ Ø¦Ø§ÙˆÛŒ Ø¨Ø¯Û•.\nâ€¢ **ØªÛŽØ¨ÛŒÙ†ÛŒ:** Ú¯Û•ÚµØ§Ú©Ø§Ù†ÛŒ Ø¨Û• Ù¾Û•Ú•Û†ÛŒ Ù†Û•Ù… Ø¨Ø³Ú•Û•ÙˆÛ• ØªØ§ Ù‡Û•Ù†Ø§Ø³Û• Ø¨Ø¯Ø§Øª.',
    'Ù¾Û•ØªÛ†Ø³': 'ðŸŒ¿ **Ù¾Û•ØªÛ†Ø³ (Pothos):**\nâ€¢ **Ø®Ø²Ù…Û•Øª:** Ø¦Ø§Ø³Ø§Ù†ØªØ±ÛŒÙ† Ú•ÙˆÛ•Ú©Û•ØŒ Ù„Û• Ú©Û•Ù… Ú•ÙˆÙˆÙ†Ø§Ú©ÛŒØ´ Ø¯Û•Ú˜ÛŒ.\nâ€¢ **Ø¦Ø§Ùˆ:** Ø¨Û•Ø±Ú¯Û•ÛŒ ÙˆØ´Ú©ÛŒ Ø¯Û•Ú¯Ø±ÛŽØªØŒ Ù‡Û•ÙØªÛ•ÛŒ Ø¬Ø§Ø±ÛŽÚ© Ø¦Ø§ÙˆÛŒ Ø¨Ø¯Û•.\nâ€¢ **Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†:** Ø¯Û•ØªÙˆØ§Ù†ÛŒØª Ù„Ù‚ÛŽÚ©ÛŒ Ø¨Ø¨Ú•ÛŒØª Ùˆ Ù„Û• Ø¦Ø§ÙˆØ¯Ø§ Ú•Û•Ú¯ Ø¯Û•Ú©Ø§Øª.',
    'Ø²Ø§Ù…ÙÛ†Ù„ÛŒØ§': 'ðŸŒ¿ **Ø²Ø§Ù…ÙÛ†Ù„ÛŒØ§ (ZZ Plant):**\nâ€¢ **ØªØ§ÛŒØ¨Û•ØªÙ…Û•Ù†Ø¯ÛŒ:** "Ú•ÙˆÛ•Ú©ÛŒ Ù¾Û†ÚµØ§ÛŒÛŒÙ†"Ù€ÛŒ Ù¾ÛŽ Ø¯Û•ÙˆØªØ±ÛŽØªØŒ Ø²Û†Ø± Ø¨Û•Ù‡ÛŽØ²Û•.\nâ€¢ **Ø¦Ø§Ùˆ:** Ù…Ø§Ù†Ú¯ÛŒ Ù¡-Ù¢ Ø¬Ø§Ø± Ø¦Ø§ÙˆÛŒ Ø¯Û•ÙˆÛŽØª (Ø²Û†Ø± Ø¦Ø§Ùˆ Ø¯Û•ÛŒÚ©ÙˆÚ˜ÛŽØª).\nâ€¢ **Ú•ÙˆÙˆÙ†Ø§Ú©ÛŒ:** Ù„Û• ØªØ§Ø±ÛŒÚ©ÛŒØ´ Ø¯Û•Ú˜ÛŒ.',
    'Ø³Ø§Ù†Ø³ÛŽÚ¤ÛŽØ±ÛŒØ§': 'ðŸŒ¿ **Ø³Ø§Ù†Ø³ÛŽÚ¤ÛŽØ±ÛŒØ§ (Sansevieria):**\nâ€¢ **Ø³ÙˆÙˆØ¯:** Ù‡Û•ÙˆØ§ Ù¾Ø§Ú© Ø¯Û•Ú©Ø§ØªÛ•ÙˆÛ• Ùˆ Ø¦Û†Ú©Ø³Ø¬ÛŒÙ† Ø¯Û•Ø±Ø¯Û•Ø¯Ø§Øª Ù„Û• Ø´Û•ÙˆØ¯Ø§.\nâ€¢ **Ø¦Ø§Ùˆ:** Ú©Û•Ù…ØªØ±ÛŒÙ† Ø¦Ø§ÙˆÛŒ Ø¯Û•ÙˆÛŽØªØŒ Ø¨Ø§ Ø®Ø§Ú©Û•Ú©Û•ÛŒ ØªÛ•ÙˆØ§Ùˆ ÙˆØ´Ú© Ø¨ÛŽØªÛ•ÙˆÛ•.',
    'Ú©Ø§Ú©ØªÙˆØ³': 'ðŸŒµ **Ú©Ø§Ú©ØªÙˆØ³ Ùˆ Ø³Ø§Ø¨ÛŒØ±Û•:**\nâ€¢ **Ø´ÙˆÛŽÙ†:** Ø­Û•Ø²ÛŒØ§Ù† Ø¨Û• Ø®Û†Ø±ÛŒ Ú•Ø§Ø³ØªÛ•ÙˆØ®Û†ÛŒÛ•.\nâ€¢ **Ø¦Ø§Ùˆ:** Ù¡Ù -Ù¡Ù¥ Ú•Û†Ú˜ Ø¬Ø§Ø±ÛŽÚ© Ù„Û• Ù‡Ø§ÙˆÛŒÙ†Ø¯Ø§ØŒ Ø²Ø³ØªØ§Ù† Ù…Ø§Ù†Ú¯ÛŒ Ø¬Ø§Ø±ÛŽÚ©.',
    'Ø´Û•Ù…Ø¹Û•': 'ðŸŒ¿ **Ú¯ÙˆÚµÛŒ Ø´Û•Ù…Ø¹Û• (Spathiphyllum):**\nâ€¢ **Ù†ÛŒØ´Ø§Ù†Û•:** Ú©Ø§ØªÛŽÚ© ØªÛŒÙ†ÙˆÙˆÛŒÛ•ØªÛŒ Ú¯Û•ÚµØ§Ú©Ø§Ù†ÛŒ Ø´Û†Ú• Ø¯Û•Ú©Ø§ØªÛ•ÙˆÛ•.\nâ€¢ **Ú¯ÙˆÚµ:** Ù¾ÛŽÙˆÛŒØ³ØªÛŒ Ø¨Û• Ú•ÙˆÙˆÙ†Ø§Ú©ÛŒ Ø¨Ø§Ø´Û• Ø¨Û† Ø¦Û•ÙˆÛ•ÛŒ Ú¯ÙˆÚµÛŒ Ø³Ù¾ÛŒ Ø¯Û•Ø±Ø¨Ú©Ø§Øª.',
  },
  diseases: {
    'Ø²Û•Ø±Ø¯': 'ðŸ‚ **Ø²Û•Ø±Ø¯Ø¨ÙˆÙˆÙ†ÛŒ Ú¯Û•ÚµØ§:**\nÙ¡. Ø²Û†Ø± Ø¦Ø§ÙˆØ¯Ø§Ù† (Ø¨Ø§ÙˆØªØ±ÛŒÙ† Ù‡Û†Ú©Ø§Ø±).\nÙ¢. Ú©Û•Ù…ÛŒ Ù…Ø§Ø¯Ø¯Û• Ø®Û†Ø±Ø§Ú©ÛŒÛŒÛ•Ú©Ø§Ù† (Ù¾Û•ÛŒÙ†).\nÙ£. Ú¯Û†Ú•Ø§Ù†ÛŒ Ù„Û•Ù†Ø§Ú©Ø§ÙˆÛŒ Ù¾Ù„Û•ÛŒ Ú¯Û•Ø±Ù…ÛŒ.\nâœ… **Ú†Ø§Ø±Û•Ø³Û•Ø±:** Ù¾Ø´Ú©Ù†ÛŒÙ† Ø¨Û† ØªÛ•Ú•ÛŒ Ø®Ø§Ú©Û•Ú©Û• Ø¨Ú©Û• Ùˆ Ø¯ÚµÙ†ÛŒØ§Ø¨Û• Ù„Û• Ú©ÙˆÙ†Û•Ú©Ø§Ù†ÛŒ Ú˜ÛŽØ± Ú¯Û†Ø²Û•Ú©Û•.',
    'Ú©Û•Ú•ÙˆÙˆ': 'ðŸ„ **Ú©Û•Ú•ÙˆÙˆ Ùˆ ÙØªØ±ÛŒØ§Øª:**\nØ¦Û•Ú¯Û•Ø± Ù¾Û•ÚµÛ•ÛŒ Ù‚Ø§ÙˆÛ•ÛŒÛŒ ÛŒØ§Ù† Ø³Ù¾ÛŒ Ù„Û•Ø³Û•Ø± Ø®Ø§Ú© ÛŒØ§Ù† Ú¯Û•ÚµØ§ Ù‡Û•Ø¨ÙˆÙˆ.\nâœ… **Ú†Ø§Ø±Û•Ø³Û•Ø±:** Ø¨Û•Ú©Ø§Ø±Ù‡ÛŽÙ†Ø§Ù†ÛŒ Ø¯Û•Ø±Ù…Ø§Ù†ÛŒ Ø¯Ú˜Û•-Ú©Û•Ú•ÙˆÙˆ (Fungicide) Ú©Û• Ù„Û• Ø´Û•ØªÚµÚ¯Û•ÛŒ Ù…ÛŒØ± Ø¯Û•Ø³Øª Ø¯Û•Ú©Û•ÙˆÛŽØª.',
    'Ù…ÛŽØ±ÙˆÙˆ': 'ðŸž **Ù…ÛŽØ±ÙˆÙˆ Ùˆ Ø³Ù¾ÛŽ:**\nØ¦Û•Ú¯Û•Ø± Ø®Ø§ÚµÛŒ Ø³Ù¾ÛŒ ÛŒØ§Ù† Ù…ÛŽØ±ÙˆÙˆÛŒ Ø¨Ú†ÙˆÙˆÚ©Øª Ø¨ÛŒÙ†ÛŒ.\nâœ… **Ú†Ø§Ø±Û•Ø³Û•Ø±:** Ø´ØªÙ†ÛŒ Ú¯Û•ÚµØ§Ú©Ø§Ù† Ø¨Û• Ø¦Ø§Ùˆ Ùˆ Ø³Ø§Ø¨ÙˆÙˆÙ†ÛŒ Ú•ÙˆÛ•Ú©ÛŒØŒ ÛŒØ§Ù† Ù‚Ø±Ù‚ÛŽÙ†Û•.',
    'Ú•Ø²ÛŒÙ†': 'ðŸ¥€ **Ú•Ø²ÛŒÙ†ÛŒ Ú•Û•Ú¯ (Root Rot):**\nØ¨Û•Ù‡Û†ÛŒ Ù…Ø§Ù†Û•ÙˆÛ•ÛŒ Ø¦Ø§ÙˆÛŒ Ø²Û†Ø± Ù„Û• Ú˜ÛŽØ± Ú¯Û†Ø²Û•Ú©Û• Ø¯Ø±ÙˆØ³Øª Ø¯Û•Ø¨ÛŽØª.\nâœ… **Ú†Ø§Ø±Û•Ø³Û•Ø±:** Ø¯Û•Ø±Ù‡ÛŽÙ†Ø§Ù†ÛŒ Ú•ÙˆÛ•Ú©Û•Ú©Û•ØŒ Ø¨Ú•ÛŒÙ†ÛŒ Ú•Û•Ú¯Û• Ú•Ø²ÛŒÙˆÛ•Ú©Ø§Ù† Ùˆ Ú¯Û†Ú•ÛŒÙ†ÛŒ Ø®Ø§Ú©Û•Ú©Û•ÛŒ.',
  }
};

const PlantApp = () => {
  const [messages, setMessages] = useState([
    {
      id: 1,
      text: "Ø³ÚµØ§Ùˆ! Ø¨Û•Ø®ÛŽØ±Ø¨ÛŽÙ† Ø¨Û† Ø´Û•ØªÚµÚ¯Û•ÛŒ Ù…ÛŒØ± ðŸŒ¿. \n\nÙ…Ù† Ù„ÛŽØ±Û•Ù… Ø¨Û† ÙˆÛ•ÚµØ§Ù…Ø¯Ø§Ù†Û•ÙˆÛ•ÛŒ Ù‡Û•Ù…ÙˆÙˆ Ù¾Ø±Ø³ÛŒØ§Ø±Û•Ú©Ø§Ù†Øª Ø¯Û•Ø±Ø¨Ø§Ø±Û•ÛŒ:\nâ€¢ Ø¬Û†Ø±Û•Ú©Ø§Ù†ÛŒ Ú•ÙˆÛ•Ú© Ùˆ Ú†Û†Ù†ÛŒÛ•ØªÛŒ Ø¨Û•Ø®ÛŽÙˆÚ©Ø±Ø¯Ù† ðŸŒ±\nâ€¢ Ú†Ø§Ø±Û•Ø³Û•Ø±ÛŒ Ù†Û•Ø®Û†Ø´ÛŒÛŒÛ•Ú©Ø§Ù† ðŸ’Š\nâ€¢ Ù†Ø±Ø® Ùˆ Ù†Ø§ÙˆÙ†ÛŒØ´Ø§Ù† ðŸ“\n\nØªÚ©Ø§ÛŒÛ• Ù†Ø§ÙˆÛŒ Ú•ÙˆÛ•Ú©Û•Ú©Û• ÛŒØ§Ù† Ú©ÛŽØ´Û•Ú©Û•Øª Ø¨Ù†ÙˆÙˆØ³Û•...",
      sender: 'bot',
      time: new Date().toLocaleTimeString('ckb-IQ', { hour: '2-digit', minute: '2-digit' })
    }
  ]);
  const [inputText, setInputText] = useState("");
  const [isLoading, setIsLoading] = useState(false);
  const [headerImgError, setHeaderImgError] = useState(false);
  const messagesEndRef = useRef(null);

  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
  };

  useEffect(() => {
    scrollToBottom();
  }, [messages]);

  const generateResponse = (text) => {
    const lowerText = text.toLowerCase();
    
    // Check for specific plants in knowledge base
    for (const [plant, info] of Object.entries(knowledgeBase.plants)) {
      if (lowerText.includes(plant)) return info;
    }

    // Check for specific diseases
    if (lowerText.includes('Ú©Û•Ú•ÙˆÙˆ') || lowerText.includes('ftryat')) return knowledgeBase.diseases['Ú©Û•Ú•ÙˆÙˆ'];
    if (lowerText.includes('Ù…ÛŽØ±ÙˆÙˆ') || lowerText.includes('Ù¾ÛŽ')) return knowledgeBase.diseases['Ù…ÛŽØ±ÙˆÙˆ'];
    if (lowerText.includes('Ú•Ø²ÛŒÙ†') || lowerText.includes('Ú•Û•Ú¯')) return knowledgeBase.diseases['Ú•Ø²ÛŒÙ†'];
    if (lowerText.includes('Ø²Û•Ø±Ø¯')) return knowledgeBase.diseases['Ø²Û•Ø±Ø¯'];

    // General Responses
    if (lowerText.includes('Ø¦Ø§Ùˆ') || lowerText.includes('water')) {
      return "ðŸ’§ **ÛŒØ§Ø³Ø§ÛŒ Ø¦Ø§ÙˆØ¯Ø§Ù†:**\nØ¨Ø§Ø´ØªØ±ÛŒÙ† Ù¾ÛŽÙˆÛ•Ø± 'Ù¾Û•Ù†Ø¬Û•'ÛŒÛ•. Ù¾Û•Ù†Ø¬Û•Øª Ø¨Ø®Û• Ù†Ø§Ùˆ Ø®Ø§Ú©Û•Ú©Û•:\nâ€¢ Ø¦Û•Ú¯Û•Ø± ØªÛ•Ú• Ø¨ÙˆÙˆ: Ø¦Ø§ÙˆÛŒ Ù…Û•Ø¯Û•.\nâ€¢ Ø¦Û•Ú¯Û•Ø± ÙˆØ´Ú© Ø¨ÙˆÙˆ: Ø¦Ø§ÙˆÛŒ Ø¨Ø¯Û•.\nâ€¢ Ø²Û†Ø±Ø¨Û•ÛŒ Ú•ÙˆÛ•Ú©Û•Ú©Ø§Ù† Ø¨Û• 'Ø²Û†Ø± Ø¦Ø§ÙˆØ¯Ø§Ù†' Ø¯Û•Ù…Ø±Ù† Ù†Û•Ú© ØªÛŒÙ†ÙˆÛŽØªÛŒ.";
    } else if (lowerText.includes('Ù¾Û•ÛŒÙ†') || lowerText.includes('Ø³Ù…Ø§Ø¯') || lowerText.includes('Ø®Û†Ø±Ø§Ú©')) {
      return "ðŸ§ª **Ù¾Û•ÛŒÙ† (Ø³Ù…Ø§Ø¯):**\nâ€¢ Ø¨Û•Ù‡Ø§Ø± Ùˆ Ù‡Ø§ÙˆÛŒÙ†: Ù‡Û•Ù…ÙˆÙˆ Ù¢ Ù‡Û•ÙØªÛ• Ø¬Ø§Ø±ÛŽÚ© NPK Ø¨Û•Ú©Ø§Ø±Ø¨Ù‡ÛŽÙ†Û•.\nâ€¢ Ù¾Ø§ÛŒØ² Ùˆ Ø²Ø³ØªØ§Ù†: Ú•ÙˆÛ•Ú© Ø¯Û•Ú†ÛŽØªÛ• Ù¾Ø´ÙˆÙˆÛ•ÙˆÛ•ØŒ Ù¾ÛŽÙˆÛŒØ³Øª Ù†Ø§Ú©Ø§Øª.\nâ€¢ Ø¨Û† Ú¯ÙˆÚµÚ©Ø±Ø¯Ù†: Ù¾Û•ÛŒÙ†ÛŒ ÙØ³ÙÛ†Ú• Ø¨Û•Ø±Ø² Ø¨Û•Ú©Ø§Ø±Ø¨Ù‡ÛŽÙ†Û•.";
    } else if (lowerText.includes('Ù†Ø§ÙˆÙ†ÛŒØ´Ø§Ù†') || lowerText.includes('Ø´ÙˆÛŽÙ†')) {
      return "ðŸ“ **Ù†Ø§ÙˆÙ†ÛŒØ´Ø§Ù†ÛŒ Ø´Û•ØªÚµÚ¯Û•ÛŒ Ù…ÛŒØ±:** \nØ³Û•Ø±Û•ØªØ§ÛŒ Ø´Û•Ù‚Ø§Ù…ÛŒ Ø³Û•Ø±Û•Ú©ÛŒØŒ ØªÛ•Ù†ÛŒØ´Øª Ø¨Ø§Ø®Ú†Û•ÛŒ Ú¯Ø´ØªÛŒ. \n\nÚ†Ø§ÙˆÛ•Ú•ÛŽÛŒ Ù‡Ø§ØªÙ†ØªØ§Ù†ÛŒÙ† Ø¨Û† Ú•Ø§ÙˆÛŽÚ˜ÛŒ Ú•Ø§Ø³ØªÛ•ÙˆØ®Û†!";
    } else if (lowerText.includes('Ù†Ø±Ø®') || lowerText.includes('price')) {
      return "ðŸ’° **Ù†Ø±Ø®Û•Ú©Ø§Ù†Ù…Ø§Ù†:**\nâ€¢ Ú•ÙˆÛ•Ú©ÛŒ Ø¨Ú†ÙˆÙˆÚ©: Ù£,Ù Ù Ù  - Ù¥,Ù Ù Ù  Ø¯ÛŒÙ†Ø§Ø±\nâ€¢ Ú•ÙˆÛ•Ú©ÛŒ Ù…Ø§Ù…Ù†Ø§ÙˆÛ•Ù†Ø¯: Ù¡Ù ,Ù Ù Ù  - Ù¡Ù¥,Ù Ù Ù  Ø¯ÛŒÙ†Ø§Ø±\nâ€¢ Ú•ÙˆÛ•Ú©ÛŒ Ú¯Û•ÙˆØ±Û•: Ù¢Ù¥,Ù Ù Ù + Ø¯ÛŒÙ†Ø§Ø±\nØ¨Û† Ù†Ø±Ø®ÛŒ ÙˆØ±Ø¯ØŒ ØªÚ©Ø§ÛŒÛ• ÙˆÛŽÙ†Û•ÛŒ Ú•ÙˆÛ•Ú©Û•Ú©Û• Ø¨Ù†ÛŽØ±Û• ÛŒØ§Ù† Ø³Û•Ø±Ø¯Ø§Ù†Ù…Ø§Ù† Ø¨Ú©Û•.";
    } else if (lowerText.includes('Ø³ÚµØ§Ùˆ') || lowerText.includes('hello')) {
      return "Ø³ÚµØ§Ùˆ Ù„Û• ØªÛ†! ðŸŒ¸ Ú†Û†Ù† Ø¯Û•ØªÙˆØ§Ù†Ù… Ø¦Û•Ù…Ú•Û† ÛŒØ§Ø±Ù…Û•ØªÛŒØª Ø¨Ø¯Û•Ù…ØŸ Ø¯Û•ØªÙˆØ§Ù†ÛŒØª Ù†Ø§ÙˆÛŒ Ù‡Û•Ø± Ú•ÙˆÛ•Ú©ÛŽÚ© Ø¨Ù¾Ø±Ø³ÛŒØª.";
    } else {
      return "Ù¾Ø±Ø³ÛŒØ§Ø±ÛŽÚ©ÛŒ Ø¨Ø§Ø´Û•! ðŸ¤”\nØ¨Û† Ø¦Û•ÙˆÛ•ÛŒ ÙˆÛ•ÚµØ§Ù…ÛŽÚ©ÛŒ ÙˆØ±Ø¯ØªØ±Øª Ø¨Ø¯Û•Ù…ÛŽØŒ Ø¯Û•ØªÙˆØ§Ù†ÛŒØª:\nÙ¡. Ù†Ø§ÙˆÛŒ Ú•ÙˆÛ•Ú©Û•Ú©Û• Ø¨Ù†ÙˆÙˆØ³ÛŒØª.\nÙ¢. Ù†ÛŒØ´Ø§Ù†Û•Ú©Ø§Ù†ÛŒ Ù†Û•Ø®Û†Ø´ÛŒÛŒÛ•Ú©Û• Ø¨Ø§Ø³ Ø¨Ú©Û•ÛŒØª.\n\nÛŒØ§Ù† Ø³Û•Ø±Ø¯Ø§Ù†ÛŒ Ø´Û•ØªÚµÚ¯Û•ÛŒ Ù…ÛŒØ± Ø¨Ú©Û• Ø¨Û† Ù¾Ø´Ú©Ù†ÛŒÙ†ÛŒ Ú•ÙˆÛ•Ú©Û•Ú©Û•Øª.";
    }
  };

  const handleSend = (e) => {
    e.preventDefault();
    if (!inputText.trim()) return;

    const userMessage = {
      id: messages.length + 1,
      text: inputText,
      sender: 'user',
      time: new Date().toLocaleTimeString('ckb-IQ', { hour: '2-digit', minute: '2-digit' })
    };

    setMessages(prev => [...prev, userMessage]);
    setInputText("");
    setIsLoading(true);

    setTimeout(() => {
      const botResponse = {
        id: messages.length + 2,
        text: generateResponse(userMessage.text),
        sender: 'bot',
        time: new Date().toLocaleTimeString('ckb-IQ', { hour: '2-digit', minute: '2-digit' })
      };
      setMessages(prev => [...prev, botResponse]);
      setIsLoading(false);
    }, 1200);
  };

  return (
    // Main Wrapper
    <div className="min-h-screen bg-slate-100 flex items-center justify-center p-0 sm:p-6 font-sans text-slate-800" dir="rtl">
      
      {/* Mobile Frame Container */}
      <div className="w-full max-w-[420px] bg-white sm:rounded-[40px] shadow-2xl overflow-hidden h-[100dvh] sm:h-[850px] flex flex-col relative border-[6px] border-slate-900/5 ring-1 ring-slate-900/10">
        
        {/* Header - Glassmorphism Style */}
        <header className="bg-emerald-600/95 backdrop-blur-md text-white p-4 pt-6 pb-4 shadow-lg z-20 relative">
          <div className="absolute inset-0 bg-gradient-to-r from-emerald-600 to-teal-600 opacity-90"></div>
          
          {/* Decorative Pattern */}
          <div className="absolute top-0 right-0 p-4 opacity-10">
             <Leaf size={64} />
          </div>

          <div className="relative flex items-center gap-3">
            <div className="relative">
              <div className="w-12 h-12 rounded-full border-2 border-white/30 p-0.5 shadow-sm">
                <div className="w-full h-full rounded-full overflow-hidden bg-white">
                  {!headerImgError ? (
                    <img 
                      src="mer.jpg" 
                      alt="Mer Logo" 
                      className="w-full h-full object-cover"
                      onError={() => setHeaderImgError(true)}
                    />
                  ) : (
                    <div className="w-full h-full bg-emerald-50 flex items-center justify-center">
                       <Leaf size={20} className="text-emerald-600" />
                    </div>
                  )}
                </div>
              </div>
              <span className="absolute bottom-0 right-0 block w-3.5 h-3.5 bg-green-400 border-2 border-emerald-600 rounded-full animate-pulse"></span>
            </div>
            
            <div className="flex-1">
              <h1 className="text-lg font-bold flex items-center gap-1">
                Ø´Û•ØªÚµÚ¯Û•ÛŒ Ù…ÛŒØ±
                <Sparkles size={14} className="text-yellow-300" />
              </h1>
              <p className="text-emerald-100 text-xs opacity-90 flex items-center gap-1">
                Ù¾Ø³Ù¾Û†Ú•ÛŒ Ú†Ø§Ø±Û•Ø³Û•Ø± Ùˆ Ø®Ø²Ù…Û•ØªÛŒ Ú•ÙˆÛ•Ú©
              </p>
            </div>
            
            <button className="bg-white/10 hover:bg-white/20 p-2 rounded-full transition-colors backdrop-blur-sm">
              <Phone size={18} className="text-white" />
            </button>
          </div>
        </header>

        {/* Chat Area */}
        <div className="flex-1 overflow-y-auto p-4 space-y-6 bg-[#f0f4f8] relative scroll-smooth">
          {/* Background Pattern */}
          <div className="absolute inset-0 opacity-[0.03]" 
               style={{backgroundImage: `url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23065f46' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}>
          </div>

          {messages.map((msg) => (
            <div
              key={msg.id}
              className={`flex items-end gap-2 group animate-in slide-in-from-bottom-2 duration-500 fade-in ${
                msg.sender === 'user' ? 'flex-row-reverse' : 'flex-row'
              }`}
            >
              {/* Avatar */}
              <div className={`w-8 h-8 rounded-full flex items-center justify-center shrink-0 shadow-sm overflow-hidden border border-white ${
                msg.sender === 'user' ? 'bg-indigo-500 hidden' : 'bg-white'
              }`}>
                {msg.sender === 'bot' && <BotAvatar />}
              </div>
              
              {/* Message Bubble */}
              <div className={`max-w-[85%] flex flex-col ${
                  msg.sender === 'user' ? 'items-end' : 'items-start'
                }`}
              >
                <div
                  className={`px-4 py-2.5 text-[15px] shadow-sm relative ${
                    msg.sender === 'user'
                      ? 'bg-emerald-600 text-white rounded-2xl rounded-br-none'
                      : 'bg-white text-slate-700 rounded-2xl rounded-bl-none border border-slate-100'
                  }`}
                >
                  <div className="whitespace-pre-line leading-relaxed">
                    {msg.text}
                  </div>
                </div>
                {/* Time */}
                <span className="text-[10px] text-slate-400 mt-1 px-1">
                  {msg.time}
                </span>
              </div>
            </div>
          ))}
          
          {isLoading && (
            <div className="flex items-center gap-2">
              <div className="w-8 h-8 rounded-full bg-white border border-slate-100 flex items-center justify-center shadow-sm">
                <Bot size={16} className="text-emerald-600" />
              </div>
              <div className="bg-white px-4 py-3 rounded-2xl rounded-bl-none shadow-sm border border-slate-100 flex gap-1.5 items-center">
                <span className="text-xs text-slate-400 ml-2">Ø¯Û•Ù†ÙˆÙˆØ³ÛŽØª</span>
                <span className="w-1.5 h-1.5 bg-emerald-400 rounded-full animate-bounce"></span>
                <span className="w-1.5 h-1.5 bg-emerald-400 rounded-full animate-bounce delay-100"></span>
                <span className="w-1.5 h-1.5 bg-emerald-400 rounded-full animate-bounce delay-200"></span>
              </div>
            </div>
          )}
          <div ref={messagesEndRef} className="h-4" />
        </div>

        {/* Input Area */}
        <div className="bg-white p-3 border-t border-slate-100 shadow-[0_-10px_40px_-15px_rgba(0,0,0,0.1)] z-20">
          
          {/* Quick Chips */}
          <div className="flex gap-2 mb-3 overflow-x-auto pb-1 scrollbar-hide px-1">
             {[
               { icon: <AlertTriangle size={14} />, text: "Ø²Û•Ø±Ø¯Ø¨ÙˆÙˆÙ†ÛŒ Ú¯Û•ÚµØ§", color: "bg-amber-50 text-amber-600 border-amber-100" },
               { icon: <Leaf size={14} />, text: "Ù…Û•ØªØ§Øª", color: "bg-emerald-50 text-emerald-600 border-emerald-100" },
               { icon: <Info size={14} />, text: "Ù¾Û•ØªÛ†Ø³", color: "bg-blue-50 text-blue-600 border-blue-100" },
               { icon: <Sun size={14} />, text: "Ú©Ø§Ú©ØªÙˆØ³", color: "bg-orange-50 text-orange-600 border-orange-100" },
               { icon: <Droplets size={14} />, text: "Ø¦Ø§ÙˆØ¯Ø§Ù†", color: "bg-cyan-50 text-cyan-600 border-cyan-100" },
             ].map((chip, idx) => (
               <button 
                key={idx}
                onClick={() => setInputText(chip.text)} 
                className={`flex items-center gap-1.5 text-xs font-semibold px-3 py-1.5 rounded-full transition-transform active:scale-95 border ${chip.color} shrink-0`}
               >
                 {chip.icon} {chip.text}
               </button>
             ))}
          </div>

          <form onSubmit={handleSend} className="flex gap-2 items-end">
            <div className="flex-1 bg-slate-100 rounded-[24px] border border-transparent focus-within:border-emerald-500 focus-within:bg-white focus-within:ring-2 focus-within:ring-emerald-100 transition-all flex items-center">
              <input
                type="text"
                value={inputText}
                onChange={(e) => setInputText(e.target.value)}
                placeholder="Ù¾Ø±Ø³ÛŒØ§Ø±Û•Ú©Û•Øª Ø¨Ù†ÙˆÙˆØ³Û• (Ù…Û•ØªØ§ØªØŒ Ø²Û•Ø±Ø¯Ø¨ÙˆÙˆÙ†...)"
                className="w-full bg-transparent px-5 py-3.5 focus:outline-none text-slate-700 placeholder-slate-400 text-base"
              />
            </div>
            
            <button
              type="submit"
              disabled={!inputText.trim() || isLoading}
              className={`w-12 h-12 rounded-full flex items-center justify-center transition-all duration-300 shadow-lg ${
                inputText.trim() 
                  ? 'bg-emerald-600 hover:bg-emerald-700 text-white transform hover:scale-105 active:scale-90 rotate-0' 
                  : 'bg-slate-200 text-slate-400 rotate-90 cursor-not-allowed'
              }`}
            >
              <Send size={20} className={document.dir === 'rtl' ? 'rotate-180' : ''} />
            </button>
          </form>
        </div>
      </div>
    </div>
  );
};

export default PlantApp;
